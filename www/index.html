<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3D-Druck Preisrechner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      transition: background-color 0.3s, color 0.3s;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    form {
      margin-bottom: 20px;
      padding: 10px;
      border: 1px solid #ccc;
    }
    fieldset {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ccc;
    }
    legend {
      font-weight: bold;
      padding: 0 10px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input[type="number"] {
      width: 100%;
      padding: 5px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
      transition: background-color 0.3s, color 0.3s;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      display: block;
      margin-left: auto;
      margin-right: auto;
      cursor: pointer;
    }
    #result {
      margin-top: 20px;
      font-weight: bold;
      font-size: 18px;
      text-align: center;
      white-space: pre-line;
    }
    .dark-mode {
      background-color: #121212;
      color: #f0f0f0;
    }
    .light-mode {
      background-color: #ffffff;
      color: #000000;
    }
    .theme-toggle {
      position: fixed;
      top: 10px;
      right: 10px;
      padding: 6px 12px;
      cursor: pointer;
      border: none;
      background: #444;
      color: white;
      border-radius: 4px;
      z-index: 1000;
    }
    .dark-mode input[type="number"] {
      background-color: #1e1e1e;
      color: #f0f0f0;
      border: 1px solid #444;
    }
    .light-mode input[type="number"] {
      background-color: #ffffff;
      color: #000000;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>

  <button class="theme-toggle" onclick="toggleTheme()">üåô / ‚òÄÔ∏è</button>

  <h1>3D-Druck Preisrechner</h1>

  <form id="setupForm">
    <label for="numPlates">Anzahl der Druckplatten:</label>
    <input type="number" id="numPlates" name="numPlates" value="1" min="1" />
    <button type="button" id="createPlatesBtn">Platten erstellen</button>
  </form>

  <form id="platesForm"></form>

  <form id="globalForm">
    <fieldset>
      <legend>Globale Faktoren</legend>

      <label for="stromkostenKwh">Stromkosten pro kWh (‚Ç¨):</label>
      <input type="number" id="stromkostenKwh" name="stromkostenKwh" step="0.01" value="0.35" min="0" />

      <label for="filamentCost">Filamentkosten pro Gramm (‚Ç¨):</label>
      <input type="number" id="filamentCost" name="filamentCost" step="0.01" value="0.02" min="0" />

      <label for="rabattFreunde">Rabatt f√ºr Freunde/Verwandte (%):</label>
      <input type="number" id="rabattFreunde" name="rabattFreunde" step="0.01" value="0" min="0" />

      <label for="verpackungVersand">Verpackung und Versand (‚Ç¨):</label>
      <input type="number" id="verpackungVersand" name="verpackungVersand" step="0.01" value="0" min="0" />

      <label>Gewinnziel:</label>
      <input type="radio" name="gewinnPreset" value="privat" onclick="setGewinnmarge(0)"> Privat (0‚ÄØ%)
      <input type="radio" name="gewinnPreset" value="freunde" onclick="setGewinnmarge(20)"> Freunde (20‚ÄØ%)
      <input type="radio" name="gewinnPreset" value="verkauf" onclick="setGewinnmarge(50)" checked> Verkauf (50‚ÄØ%)
      <input type="radio" name="gewinnPreset" value="profi" onclick="setGewinnmarge(100)"> Profi (100‚ÄØ%)

      <label for="gewinnmarge">Gewinnmarge (%):</label>
      <input type="number" id="gewinnmarge" name="gewinnmarge" step="0.01" value="50" min="0" />

      <label for="wartungskosten">Wartungskosten pro Stunde (‚Ç¨):</label>
      <input type="number" id="wartungskosten" name="wartungskosten" step="0.01" value="0.20" min="0" />
    </fieldset>
  </form>

  <button type="button" id="calcBtn">Gesamtpreis berechnen</button>

  <div id="result"></div>

  <script>
    function toggleTheme() {
      const body = document.body;
      if (body.classList.contains('dark-mode')) {
        body.classList.remove('dark-mode');
        body.classList.add('light-mode');
        localStorage.setItem('theme', 'light');
      } else {
        body.classList.remove('light-mode');
        body.classList.add('dark-mode');
        localStorage.setItem('theme', 'dark');
      }
    }

    function setGewinnmarge(wert) {
      document.getElementById("gewinnmarge").value = wert;
    }

    window.onload = function () {
      const savedTheme = localStorage.getItem('theme') || 'dark';
      document.body.classList.add(savedTheme + '-mode');
    };

    document.getElementById("createPlatesBtn").addEventListener("click", function () {
      const platesForm = document.getElementById("platesForm");
      platesForm.innerHTML = "";

      const numPlates = parseInt(document.getElementById("numPlates").value, 10);
      if (isNaN(numPlates) || numPlates < 1) {
        alert("Bitte eine g√ºltige Anzahl angeben.");
        return;
      }

      for (let i = 1; i <= numPlates; i++) {
        const fieldset = document.createElement("fieldset");
        fieldset.innerHTML = `
          <legend>Druckplatte ${i}</legend>

          <label for="druckzeitStunden${i}">Druckzeit (Stunden):</label>
          <input type="number" id="druckzeitStunden${i}" name="druckzeitStunden${i}" value="0" min="0" />

          <label for="druckzeitMin_${i}">Druckzeit (Minuten):</label>
          <input type="number" id="druckzeitMin_${i}" name="druckzeitMin_${i}" value="0" min="0" />

          <label for="filament${i}">Filamentverbrauch (Gramm):</label>
          <input type="number" id="filament${i}" name="filament${i}" value="0" min="0" />

          <label for="farbwechsel${i}">Anzahl der Farbwechsel:</label>
          <input type="number" id="farbwechsel${i}" name="farbwechsel${i}" value="0" min="0" />

          <label for="abfallFarbwechsel${i}">Abfall pro Farbwechsel (Gramm):</label>
          <input type="number" id="abfallFarbwechsel${i}" name="abfallFarbwechsel${i}" value="0" min="0" />
        `;
        platesForm.appendChild(fieldset);
      }
    });

    document.getElementById("calcBtn").addEventListener("click", function () {
      const numPlates = parseInt(document.getElementById("numPlates").value, 10);
      if (isNaN(numPlates) || numPlates < 1) {
        document.getElementById("result").textContent = "Bitte zuerst Platten erstellen.";
        return;
      }

      let totalMinutes = 0;
      let totalFilament = 0;

      for (let i = 1; i <= numPlates; i++) {
        const hours = parseFloat(document.getElementById("druckzeitStunden" + i).value) || 0;
        const minutes = parseFloat(document.getElementById("druckzeitMin_" + i).value) || 0;
        const filamentUsed = parseFloat(document.getElementById("filament" + i).value) || 0;
        const farbwechsel = parseFloat(document.getElementById("farbwechsel" + i).value) || 0;
        const abfallProFarbwechsel = parseFloat(document.getElementById("abfallFarbwechsel" + i).value) || 0;

        const minutesPlate = (hours * 60) + minutes;
        totalMinutes += minutesPlate;
        totalFilament += filamentUsed + (farbwechsel * abfallProFarbwechsel);
      }

      const stromkostenKwh = parseFloat(document.getElementById("stromkostenKwh").value) || 0;
      const filamentCost = parseFloat(document.getElementById("filamentCost").value) || 0;
      const rabattFreunde = parseFloat(document.getElementById("rabattFreunde").value) || 0;
      const verpackungVersand = parseFloat(document.getElementById("verpackungVersand").value) || 0;
      const gewinnmarge = parseFloat(document.getElementById("gewinnmarge").value) || 0;
      const wartungskosten = parseFloat(document.getElementById("wartungskosten").value) || 0;

      const totalHours = totalMinutes / 60;
      let stromGesamt = totalHours * stromkostenKwh;
      let filamentGesamt = totalFilament * filamentCost;
      let gesamtVorRabatt = stromGesamt + filamentGesamt;
      let gesamtNachRabatt = gesamtVorRabatt * (1 - (rabattFreunde / 100));
      let wartungGesamt = totalHours * wartungskosten;
      
      // Versandkosten werden nach Gewinnmarge addiert
      let kostenVorMarge = gesamtNachRabatt + wartungGesamt;
      let finalPreis = (kostenVorMarge * (1 + (gewinnmarge / 100))) + verpackungVersand;

      const resultText =
        "Gesamt-Druckzeit: " + totalHours.toFixed(2) + " Stunden\n" +
        "Gesamter Filamentverbrauch (inkl. Abfall): " + totalFilament.toFixed(2) + " g\n\n" +
        "Stromkosten: " + stromGesamt.toFixed(2) + " ‚Ç¨\n" +
        "Filamentkosten: " + filamentGesamt.toFixed(2) + " ‚Ç¨\n" +
        "Zwischensumme vor Rabatt: " + gesamtVorRabatt.toFixed(2) + " ‚Ç¨\n" +
        "Nach Rabatt: " + gesamtNachRabatt.toFixed(2) + " ‚Ç¨\n" +
        "Wartungskosten: " + wartungGesamt.toFixed(2) + " ‚Ç¨\n" +
        "Verpackung & Versand: " + verpackungVersand.toFixed(2) + " ‚Ç¨\n" +
        "Kosten vor Marge: " + kostenVorMarge.toFixed(2) + " ‚Ç¨\n" +
        "Endpreis (mit " + gewinnmarge.toFixed(2) + "% Gewinnmarge): " + finalPreis.toFixed(2) + " ‚Ç¨";

      document.getElementById("result").textContent = resultText;
    });
  </script>
</body>
</html>
