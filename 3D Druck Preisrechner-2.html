<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3D-Druck Preisrechner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    form {
      margin-bottom: 20px;
      padding: 10px;
      border: 1px solid #ccc;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input[type="number"] {
      width: 100%;
      padding: 5px;
      box-sizing: border-box;
    }
    fieldset {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ccc;
    }
    legend {
      font-weight: bold;
      padding: 0 10px;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      display: block;
      margin-left: auto;
      margin-right: auto;
      cursor: pointer;
    }
    #result {
      margin-top: 20px;
      font-weight: bold;
      font-size: 18px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>3D-Druck Preisrechner</h1>

  <!-- Formular zur Auswahl der Anzahl Druckplatten -->
  <form id="setupForm">
    <label for="numPlates">Anzahl der Druckplatten:</label>
    <input
      type="number"
      id="numPlates"
      name="numPlates"
      value="1"
      min="1"
    />
    <button type="button" id="createPlatesBtn">Platten erstellen</button>
  </form>

  <!-- Hier werden dynamisch die Felder für jede Druckplatte eingefügt -->
  <form id="platesForm"></form>

  <!-- Bereich für globale Angaben, die am Ende berechnet werden -->
  <form id="globalForm">
    <fieldset>
      <legend>Globale Faktoren</legend>
      <label for="stromkostenKwh">Stromkosten pro kWh (€):</label>
      <input
        type="number"
        id="stromkostenKwh"
        name="stromkostenKwh"
        step="0.01"
        value="0.30"
        min="0"
      />

      <label for="rabattFreunde">Rabatt für Freunde/Verwandte (%):</label>
      <input
        type="number"
        id="rabattFreunde"
        name="rabattFreunde"
        step="0.01"
        value="0"
        min="0"
      />

      <label for="verpackungVersand">Verpackung und Versand (€):</label>
      <input
        type="number"
        id="verpackungVersand"
        name="verpackungVersand"
        step="0.01"
        value="0"
        min="0"
      />
    </fieldset>
  </form>

  <!-- Button zur Gesamtberechnung -->
  <button type="button" id="calcBtn">Gesamtpreis berechnen</button>

  <!-- Ergebnisanzeige -->
  <div id="result"></div>

  <script>
    // Knopf: Erzeugt dynamisch die Eingabefelder pro Platte
    document.getElementById("createPlatesBtn").addEventListener("click", function () {
      const platesForm = document.getElementById("platesForm");
      platesForm.innerHTML = ""; // Vorherige Felder löschen

      const numPlates = parseInt(document.getElementById("numPlates").value, 10);
      if (isNaN(numPlates) || numPlates < 1) {
        alert("Bitte eine gültige Anzahl angeben.");
        return;
      }

      for (let i = 1; i <= numPlates; i++) {
        const fieldset = document.createElement("fieldset");
        fieldset.innerHTML = `
          <legend>Druckplatte ${i}</legend>
          <label for="druckzeitStunden${i}">Druckzeit (Stunden):</label>
          <input type="number" id="druckzeitStunden${i}" name="druckzeitStunden${i}" value="0" min="0" />

          <label for="druckzeitMin1_${i}">Druckzeit (Minuten):</label>
          <input type="number" id="druckzeitMin1_${i}" name="druckzeitMin1_${i}" value="0" min="0" />

          <label for="druckzeitMin2_${i}">Druckzeit (Minuten):</label>
          <input type="number" id="druckzeitMin2_${i}" name="druckzeitMin2_${i}" value="0" min="0" />

          <label for="farbwechsel${i}">Anzahl der Farbwechsel:</label>
          <input type="number" id="farbwechsel${i}" name="farbwechsel${i}" value="0" min="0" />

          <label for="abfallFarbwechsel${i}">Abfall pro Farbwechsel (Gramm):</label>
          <input type="number" id="abfallFarbwechsel${i}" name="abfallFarbwechsel${i}" value="0" min="0" />
        `;
        platesForm.appendChild(fieldset);
      }
    });

    // Knopf: Führt eine Beispiel-Berechnung durch
    document.getElementById("calcBtn").addEventListener("click", function () {
      const numPlates = parseInt(document.getElementById("numPlates").value, 10);
      if (isNaN(numPlates) || numPlates < 1) {
        document.getElementById("result").textContent = "Bitte erst Platten erstellen.";
        return;
      }

      let totalMinutes = 0;
      let totalFarbwechsel = 0;
      let totalAbfall = 0;

      // Daten pro Platte einsammeln
      for (let i = 1; i <= numPlates; i++) {
        const hours = parseFloat(document.getElementById("druckzeitStunden" + i).value) || 0;
        const min1 = parseFloat(document.getElementById("druckzeitMin1_" + i).value) || 0;
        const min2 = parseFloat(document.getElementById("druckzeitMin2_" + i).value) || 0;
        const farbwechsel = parseFloat(document.getElementById("farbwechsel" + i).value) || 0;
        const abfallProFarbwechsel = parseFloat(document.getElementById("abfallFarbwechsel" + i).value) || 0;

        // Gesamtminuten pro Platte
        const minutesPlate = (hours * 60) + min1 + min2;
        totalMinutes += minutesPlate;

        // Farbwechsel und Abfall summieren
        totalFarbwechsel += farbwechsel;
        totalAbfall += farbwechsel * abfallProFarbwechsel;
      }

      // Globale Faktoren
      const stromkostenKwh = parseFloat(document.getElementById("stromkostenKwh").value) || 0;
      const rabattFreunde = parseFloat(document.getElementById("rabattFreunde").value) || 0;
      const verpackungVersand = parseFloat(document.getElementById("verpackungVersand").value) || 0;

      // Beispielhafte Kalkulation:
      // 1) Druckzeit in Stunden
      const totalHours = totalMinutes / 60;

      // 2) Stromkosten (sehr vereinfacht!)
      //    In der Praxis brauchst du: (Leistungsaufnahme [kW] * Druckzeit [h]) * Stromkosten [€/kWh].
      //    Hier wird beispielhaft nur "Stunden * Stromkosten" gerechnet.
      let stromGesamt = totalHours * stromkostenKwh;

      // 3) Rabatt anwenden
      let preisNachRabatt = stromGesamt - (stromGesamt * (rabattFreunde / 100));

      // 4) Verpackung & Versand draufschlagen
      let endPreis = preisNachRabatt + verpackungVersand;

      // Ausgabe
      let resultText = "Gesamtstunden (alle Platten): " + totalHours.toFixed(2) + " h\n"
                     + "Summe Farbwechsel: " + totalFarbwechsel + "\n"
                     + "Summe Abfall (Gramm): " + totalAbfall.toFixed(2) + "\n\n"
                     + "Beispiel-Kostenrechnung:\n"
                     + "Stromkosten (vereinfacht): " + stromGesamt.toFixed(2) + " €\n"
                     + "Preis nach Rabatt: " + preisNachRabatt.toFixed(2) + " €\n"
                     + "Endpreis (inkl. Versand): " + endPreis.toFixed(2) + " €";

      // Im Browser anzeigen (Zeilenumbrüche durch <br> ersetzen)
      document.getElementById("result").innerHTML = resultText.replace(/\n/g, "<br>");
    });
  </script>
</body>
</html>
